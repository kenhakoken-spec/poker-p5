# Poker3 - ペルソナ5スタイル ポーカー記録アプリ

## プロジェクト概要

ライブテキサスホールデムポーカー時の記録アプリ。タップ数を最小化し、正確に記録し、ヒストリーとして蓄積。Geminiに投げてフィードバックを受け取り成長する。ライブポーカーのテンションに合わせた派手で直感的なUI/UXを実現。

## コア要件

### 機能要件
- **最小タップ数**: 3タップ入力（Position → Action+Size同時選択）
- **必然な選択肢の自動化**: テキサスホールデムのルールを理解し、ユーザーに選ばせない
  - オールイン検出と自動スキップ
  - フォールドしか選べない場合の自動処理
  - 選択肢が1つしかない場合は自動実行（タップ不要）
- **データ構造**: poker1と同じ（参考リポジトリ: `C:\Users\kenha\OneDrive\ドキュメント\cursor\poker1` のロジックを参照）
- **Gemini統合**: エクスポート + 自動コピー + Gemini Web/App起動（テストにも含める）
- **ヒーロー選択**: ハンド開始ごとに自分のポジションを選択。ハンド（ホールカード）も入力可能。P5演出付き。
- **結果入力**: 簡略のまま（勝利 +10BB / 敗北 -10BB 固定）
- **UI言語**: 日本語のみ

### デザイン方針（現状評価・維持ポイント）
- **現状評価**: デザインの方向性は良好とする。パンク・雑誌コラージュ、赤黒白の配色、skew/clip-path、ジャキーン演出、記録開始タイトルの文字アニメなどは維持する。
- **維持するポイント**: 配色（#D50000/#000000/#FFFFFF）・非対称レイアウト・ポリゴン形状・動的演出・タッチフィードバック（scale 0.92、スプラッシュ）・**縦スクロールは絶対にさせない**。
- **基準デバイス**: Pixel 8 Pro を基準ビューポートとし、縦幅を入れた上で全画面を縦スクロールなしで表示する。

### デザイン要件（ペルソナ5スタイル）
- **メタファー**: 「パンク・ロックな雑誌のコラージュ」を伝える
- **コンセプト**: ポップパンク（大衆志向 + 反体制）、アバンギャルド、パンク、動的UI
- **配色**: 赤（#D50000）、黒（#000000）、白（#FFFFFF）の3色のみ。背景はごく薄い赤やグラデーション（例: #0a0505）を入れてもよい
- **非対称レイアウト**: transform: skewX(-10deg)〜(-15deg) を多用。グリッドに沿わせず、画面からはみ出す大胆なレイアウト
- **ポリゴン形状**: clip-path を使い、鋭利な台形や不規則な多角形。左右非対称
- **タイポグラフィ**: 可読性を無視しない範囲で、極太のサンセリフ体や不規則なウェイトのフォント。利益は巨大な白抜き文字、損失は滴るような赤色
- **動的演出**: 「静止している瞬間がない」動的UI。要素はランダム方向から収束、stagger 0.05秒、scale + rotate で 0.2秒程度の「ジャキーン」演出
- **マイクロインタラクション**: 
  - ボタンホバー: scale(1.1) + rotate(-3deg)、テキストの震え・ポリゴン変形
  - ボタンタップ: scale(0.95) で凹み → 戻る + 背後に赤スプラッシュ
  - All-in ボタン: 画面全体が赤くフラッシュ + 文字が突き抜ける（0.2〜0.3秒、記録画面のみ）
- **フリック・ドラッグ**: 慣性スクロール（cubic-bezier）、バウンド停止。ドラッグ時は z-index + box-shadow + translateY で浮き上がり
- **アイドリング**: 規則的でないリズムで脈動・微細なノイズ（blur/opacity変化）
- **必殺プロパティ3選**: transform: skew()、clip-path、keyframes + animation

### TOP画面のP5風劇的演出
1. **背景の動的演出**: ランダムな方向にゆっくり流れる星型・破片のパーティクル（CSSアニメーション）。ごく薄い赤やグラデーションを背景に追加
2. **情報の巨大化**: 勝率と記録数を画面を横切るような巨大フォントで配置。`mix-blend-mode: difference`で背景と重なった時に色が反転する効果
3. **情報の隠蔽と露出**: メニュー項目（履歴、設定、解析）は最初から見せず、タップ時に**右斜め30度で3つがずれて**「ジャキーン」と展開。視線誘導の線は画面幅の27%の位置

### タッチ・インタラクション
- **ボタンのフィードバック**: 全てのタップ可能な要素に `active: scale(0.92)` を適用。指を離した瞬間に、背後から赤い「スプラッシュ（破片）」のエフェクトが飛び散る
- **慣性スクロール**: `cubic-bezier(0.22, 1, 0.36, 1)` の減速曲線、微かなバウンド停止
- **ドラッグ演出**: 要素をドラッグする際、z-indexで最前面に浮き上がり、進行方向に対してわずかに傾く

### 動的演出（Framer Motion）
- **画面遷移**: 画面を斜めに切り裂くような clip-path アニメーション（0.3秒）
- **stagger効果**: リスト表示時、各項目が0.03秒ずつのディレイで、画面外からスライドイン・回転しながら収束
- **アイドリング**: 画面上の重要な数字やボタンは、常に微細なノイズ（わずかな震えや明滅）を持たせ、「生きているUI」に

### ポーカーロジック要件
- **参考リポジトリ**: 
  - poker1: `C:\Users\kenha\OneDrive\ドキュメント\cursor\poker1` の PokerHandEngine、types、POKER_ENGINE_GUIDE.md を参照
  - PokerKit (uoftcprg/pokerkit): 世界標準のルール実装を参考
  - Treys (ihendley/treys): ハンド評価アルゴリズムを参考
- **6MAX Positions**: UTG, MP, CO, BTN, SB, BB（poker1 は HJ だが、MP で統一）
- **アクション順序**: 
  - Preflop: UTG → MP → CO → BTN → SB → BB
  - Postflop: SB → BB → UTG → MP → CO → BTN
- **ベッティングロジック**:
  - Preflop: Bet-relative (2x, 3x, all-in)。オールイン時は「100x」ではなく「オールイン (BB)」と表示
  - Postflop first action: Pot-relative (1/3, 1/2, pot, all-in)
  - Postflop against bet/raise: Bet-relative (2x, 3x, all-in)
- **ポット計算**: アクションヒストリーから自動計算（call も含む）。手動入力しない
- **ストリート進行**: ラウンドが閉じたときのみ次のストリートへ。1人残り（全員フォールド）の場合はハンド終了
- **オールイン検出**: 全プレイヤーがオールイン時は自動スキップ
- **狭幅対応**: Pixel 8 Pro を基準ビューポートにし、それ以外はレスポンシブで対応

## 技術スタック

- **フレームワーク**: Next.js (App Router)
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **アニメーション**: Framer Motion
- **アイコン**: Lucide-react
- **ストレージ**: LocalStorage（自動保存）
- **デプロイ**: Vercel

## ファイル構造

```
poker3/
├── src/
│   ├── app/
│   │   ├── layout.tsx
│   │   ├── page.tsx                    # TOP画面（P5風劇的演出）
│   │   ├── record/
│   │   │   └── page.tsx
│   │   └── history/
│   │       └── page.tsx
│   ├── components/
│   │   ├── ui/
│   │   │   ├── Button.tsx
│   │   │   ├── Panel.tsx
│   │   │   └── Card.tsx
│   │   ├── home/
│   │   │   ├── ParticleBackground.tsx
│   │   │   ├── RevenueDisplay.tsx
│   │   │   └── MenuExpander.tsx
│   │   └── poker/
│   │       ├── PositionSelector.tsx
│   │       ├── ActionSizeSelector.tsx
│   │       ├── PotDisplay.tsx
│   │       └── StackDisplay.tsx
│   ├── types/
│   │   └── poker.ts
│   ├── utils/
│   │   ├── storage.ts
│   │   ├── pokerUtils.ts
│   │   ├── potUtils.ts
│   │   └── bettingUtils.ts
│   └── contexts/
│       └── HandContext.tsx
```

## 開発方針

### サブエージェント戦略
- メインエージェントはPMOに徹し、実装はサブエージェントに委譲
- 各サブエージェントは専門領域に集中
- 実装→テストを繰り返し、問題なく完成したら報告
- **THルール検証サブエージェント**: テキサスホールデムルール準拠を検証専任。定義は docs/TH_VERIFICATION_AGENT.md。ロジック変更後は `npm run test:run` で tests/pokerLogic.test.ts と tests/thVerification.test.ts を実行し、全パスするまで検証を繰り返す。

### 品質基準
- TypeScriptの型安全性を徹底（anyを避ける）
- ポーカーロジックの正確性を最優先（PokerKit準拠）
- タップ数最小化を徹底（必然な選択肢は自動処理）
- P5スタイルの視覚効果を実現（動的で「静止している瞬間がない」）
- モバイル最適化（タッチターゲットサイズ、レスポンシブ）

## 注意事項

- **競合時の優先順位**: 本チャットでの追加指示を最優先
- **参考リポジトリ**: poker1 の PokerHandEngine を優先的に参考にする。PokerKit も参照
- **コンテキスト維持**: メインエージェント（PMO）がコンテキストを維持
- **エンコーディング**: 全てのファイルはUTF-8（BOMなし）
- **テスト**: 約200パターンのテストスイートを実装。ロジック + 記録フロー（ヒーロー選択 → ポジション → アクション → 結果）+ Gemini 連携まで含める