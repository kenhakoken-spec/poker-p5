# Task Plan - 2026/01/29

## ユーザー要求の整理

### UI/UX改善
1. **ハンド選択UI改善**
   - ハンドは必須（オプションではない）✓ 前回対応済み
   - スートを縦に並べる（長すぎるため）
   - スートごとにリール可能に
   - スートに色をつける（ペルソナ風、視認性向上）
   - 全カードにスートマーク不要（見やすさ優先）

2. **Who is Open 画面**
   - "No open" 削除 ✓ 前回対応済み
   - 表示は良好

3. **アクション選択**
   - オールインが2つあるので片方削除（全ストリート共通）
   - ベット表示を「33.3333」→「33%」に変更
   - 自スタックを超える選択肢は非表示 → オールインに統合

4. **対向者（Opponents）画面**
   - 英語に統一 ✓ 前回対応済み
   - Who is Open と表示を合わせる
   - 選択済みのポジション（Opener）はグレー表示
   - Call だけでなく Raise (3bet) も考慮 ✓ 前回対応済み

5. **フロップ選択**
   - ハンド選択と同様のUI（スート縦並び・リール）
   - 選択済みカード3枚を大きく・P5風のかっこいい登場演出

6. **ターン/リバー選択**
   - 前ストリートのカードも表示
   - ポジション/アクション選択時、場のカードを上部に常時表示

7. **フロップ以降のポジション選択**
   - 最初のポジション選択を自動化（自明なため）
   - タップ数削減

8. **リバー進行バグ修正**
   - 何を選んでも次に進まない問題
   - テスト計画を記録し、実機上で検証

### ポーカーロジック改善
9. **スタック計算の精度向上**
   - 100BBスタート
   - poker1 参照

10. **その他確認事項**
    - 全員フォールド → BB勝利（No open不要）✓ 対応済み
    - オープナー以降の選択簡略化 ✓ 対応済み
    - マイハンド・マイポジション表示 ✓ 対応済み
    - 残ポジション表示 ✓ 対応済み

---

## サブエージェント振り分け

### Sub-agent 1: UI改善（ハンド/ボード選択）
**責任範囲**: ハンド選択・フロップ/ターン/リバー選択UIの全面改修

**タスク**:
- HeroSelector: スート縦並び・色つけ・リール化
- BoardSelector: スート縦並び・色つけ・リール化
- 選択済みカード表示（大きく・P5風演出）
- ターン/リバー時に前ストリートカード表示
- ポジション/アクション選択時に場のカード上部表示

**成果物**:
- `components/poker/HeroSelector.tsx`
- `components/poker/BoardSelector.tsx`
- `components/poker/CardReel.tsx` (必要に応じて拡張)
- E2Eテスト更新

**検証**:
- cursor-browser-extension MCPでUI確認
- タップ操作の流れ確認

---

### Sub-agent 2: アクション選択・ベット表示改善
**責任範囲**: アクション選択UI・ベットサイズ表示の改善

**タスク**:
- オールイン重複削除（全ストリート）
- ベット表示「33.3333」→「33%」
- 自スタック超過選択肢を非表示・オールイン統合
- bettingUtils.ts の改修

**成果物**:
- `components/poker/ActionSizeSelector.tsx`
- `utils/bettingUtils.ts`
- 単体テスト更新

**検証**:
- 各ストリートでのアクション選択肢確認
- スタック計算の整合性確認

---

### Sub-agent 3: 対向者画面・フロップ以降自動化
**責任範囲**: Opponents画面の改善・フロップ以降のポジション選択自動化

**タスク**:
- Opponents画面: Opener をグレー表示
- Who is Open と表示統一
- フロップ以降の最初のポジション選択を自動化（nextToAct が自明な場合）
- record/page.tsx の改修

**成果物**:
- `app/record/page.tsx` (preflopOpponents部分)
- フロップ以降のポジション選択ロジック
- E2Eテスト更新

**検証**:
- プリフロップ→フロップ→ターン→リバーの流れ確認
- 自動化によるタップ数削減確認

---

### Sub-agent 4: リバー進行バグ修正・テスト計画
**責任範囲**: リバー完了後の進行バグ修正・テスト計画策定と実行

**タスク**:
- リバー進行バグの特定と修正
- E2Eテストで全フロー検証
- テスト計画ドキュメント作成（記録まで含む）
- cursor-browser-extension MCPで実機検証

**成果物**:
- バグ修正コミット
- `docs/TEST_PLAN_FULL_FLOW.md`
- E2Eテスト更新
- 実機検証レポート

**検証**:
- プリフロップ→フロップ→ターン→リバー→勝者の完全フロー
- 各ストリートでの分岐パターン確認

---

## 実行順序

1. **Sub-agent 4（リバーバグ修正）**: 最優先で修正
2. **Sub-agent 1（UI改善）**: ハンド/ボード選択の大規模改修
3. **Sub-agent 2（アクション選択）**: ベット表示・選択肢改善
4. **Sub-agent 3（対向者・自動化）**: フロー簡略化

各サブエージェントは実装→テスト→MCP検証を行い、完了報告をPMOに上げる。
